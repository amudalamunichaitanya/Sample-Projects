<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Todo App with CRUD</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    body {
      background: #f0f4f8;
      font-family: 'Segoe UI', sans-serif;
    }
    .elegant-navbar {
      background: linear-gradient(135deg, #2c3e50, #4ca1af);
      transition: background 0.3s ease;
    }
    .elegant-navbar a.navbar-brand,
    .elegant-navbar a.home,
    .elegant-navbar .btn-light {
      color: #d68c8c !important;
      transition: color 0.3s ease, background 0.3s ease;
    }
    .elegant-navbar .btn-light:hover {
      background-color: #68728a;
      color: #2c3e50;
    }
    .todo-info-section {
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 12px;
      margin: 40px auto;
      max-width: 90%;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    .animated-image { animation: floatIn 1.2s ease forwards; opacity: 0; }
    @keyframes floatIn {
      0% { transform: translateY(30px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    .text-box { flex: 1; }
    .image-box { flex-shrink: 0; }
    body {
      background: url('https://images.unsplash.com/photo-1508780709619-79562169bc64?auto=format&fit=crop&w=1400&q=80') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Segoe UI', sans-serif;
      color: #333;
    }
    .container {
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }
    .task-section { margin-top: 30px; }
    .task-list li { display: flex; align-items: center; justify-content: start; gap: 15px; }
    .task-list li:hover { background: #f1f1f1; }
    .completed span { text-decoration: line-through; color: gray; }
    .btn-sm { padding: 5px 10px; }
    .mt-5 { margin-top: 26rem !important; }
    .picture { align-self: center; }
    #clock { font-size: 1rem; }
    #dropdownMenu a {
      text-decoration: none;
      color: #333;
      display: block;
      padding: 5px 10px;
    }
    #dropdownMenu a:hover {
      background-color: #f0f4f8;
      color: #2575fc;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<!-- Header -->
<nav class="navbar navbar-expand-lg navbar-dark px-4 elegant-navbar">
  <a class="navbar-brand" href="#">
    <i class="fas fa-list-check">
      <img src="cut-out-paper-checklist-icon.jpg" width="40" alt="Logo" />
    </i>MY TODO LIST
  </a>

  <!-- Dropdown -->
  <div id="userMenu" style="display: none; position: relative;">
    <a href="#" onclick="toggleDropdown()" style="color: white; font-weight: bold;">My Menu ‚ñº</a>
    <ul id="dropdownMenu" style="display: none; position: absolute; background: white; padding: 10px; border-radius: 8px; top: 100%; right: 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1); min-width: 180px;">
      <!-- User List -->
      <li style="margin-top: 5px;">
        <a href="#" onclick="toggleUserList()" style="text-decoration:none; color: #333;">User List ‚ñ∏</a>
        <ul id="userSubMenu" style="display: none; list-style: none; padding-left: 15px; margin-top: 5px;">
          <li><input type="text" id="userSearch" class="form-control form-control-sm mb-2" placeholder="Search user..."></li>
          <li><ul id="filteredUsers" style="list-style: none; padding-left: 10px;"></ul></li>
        </ul>
      </li>
      <li>
        <a href="#" style="text-decoration:none; color: #333;">Tasks ‚ñ∏</a>
        <ul style="list-style: none; padding-left: 15px; margin-top: 5px;">
          <li><a href="#" style="text-decoration:none; color: #333;">completed Task</a></li>
          <li><a href="#" style="text-decoration:none; color: #333;">Yet to be done </a></li>
          <li><a href="#" style="text-decoration:none; color: #333;">Edited Tasks</a></li>
        </ul>
      </li>
      <li style="margin-top: 5px;"><a href="#" style="text-decoration:none; color: #333;">Settings</a></li>
    </ul>
  </div>

  <div class="ms-auto">
    <a href="#" class="home">Home</a> 
    <a href="signup.html" class="btn btn-light btn-sm">Logout</a>
  </div>
</nav>

<!-- Info Section -->
<section class="todo-info-section d-flex flex-column flex-md-row align-items-center justify-content-center px-4 py-5 gap-4">
  <div class="text-box">
    <h2 class="fw-bold">Why Use a To-Do List?</h2>
    <p class="lead">
      A to-do list helps you stay focused, organize your day, and manage your time effectively.
      It boosts productivity and keeps you motivated as you tick off completed tasks.
    </p>
  </div>
  <div class="image-box">
    <img src="time-organization-concept-close-up.jpg" alt="To-Do Illustration" class="img-fluid animated-image" style="max-width: 300px;">
  </div>
</section>

<!-- Container -->
<div class="container py-5">
  <div class="row g-3 mb-4 align-items-center">
    <div class="col-md-5">
      <input type="text" id="task-input" class="form-control" placeholder="Enter a new task...">
    </div>
    <div class="col-md-4">
      <input type="date" id="task-date" class="form-control">
    </div>
    <div class="col-md-3">
      <button class="btn btn-primary w-100" onclick="addTask()">Add</button>
    </div>
  </div>

  <!-- Pending -->
  <div class="task-section">
    <h4>üìù Pending Tasks</h4>
    <ul class="list-group task-list" id="pending-list"></ul>
  </div>

  <!-- Completed -->
  <div class="task-section mt-4">
    <h4>‚úÖ Completed Tasks</h4>
    <ul class="list-group task-list completed" id="completed-list"></ul>
  </div>
</div>

<footer class="text-center text-muted py-4 mt-5">
  <img src="https://cdn-icons-png.flaticon.com/512/1055/1055646.png" width="40" alt="Logo" />
  <p class="mt-2">Built with ‚ù§Ô∏è for productivity</p>
</footer>

<script>
  // Redirect if not logged in
  const isLoggedIn = localStorage.getItem("isLoggedIn");
  if (!isLoggedIn || isLoggedIn !== "true") {
    window.location.href = "signup.html";
  }

  // ‚úÖ Parse user properly
  const userData = JSON.parse(localStorage.getItem('todoUser'));
  if (!userData || !userData.username) {
    window.location.href = 'signup.html';
  }
  const user = userData.username;

  // ‚úÖ Maintain users array
  let users = JSON.parse(localStorage.getItem("users")) || [];
  if (!users.includes(user)) {
    users.push(user);
    localStorage.setItem("users", JSON.stringify(users));
  }

  let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
  let isEditing = false;
  let editIndex = null;

  function toggleDropdown() {
    const menu = document.getElementById('dropdownMenu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
  }

  window.onload = () => {
    if (isLoggedIn) {
      document.getElementById('userMenu').style.display = 'block';
    }
  };

  function saveTasks() {
    localStorage.setItem('tasks', JSON.stringify(tasks));
  }

  function renderTasks() {
    const pendingList = document.getElementById('pending-list');
    const completedList = document.getElementById('completed-list');
    pendingList.innerHTML = '';
    completedList.innerHTML = '';

    tasks.forEach((task, index) => {
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
        <span>${task.text}</span>
        <div>
          ${!task.completed ? `
            <button class="btn btn-success btn-sm me-1" onclick="completeTask(${index})">Complete</button>
            <button class="btn btn-warning btn-sm me-1" onclick="editTask(${index})">Edit</button>
          ` : ''}
          <button class="btn btn-danger btn-sm" onclick="deleteTask(${index})">Delete</button>
        </div>
      `;
      if (task.completed) {
        li.classList.add("completed");
        completedList.appendChild(li);
      } else {
        pendingList.appendChild(li);
      }
    });
  }

  function addTask() {
    if (localStorage.getItem("isLoggedIn") !== "true") {
      alert("Please login to add tasks.");
      return;
    }
    const input = document.getElementById('task-input');
    const value = input.value.trim();
    if (!value) return;
    if (isEditing) {
      tasks[editIndex].text = value;
      isEditing = false;
      editIndex = null;
    } else {
      const date = document.getElementById('task-date').value;
      tasks.push({ text: value, date: date, completed: false });
    }
    input.value = '';
    saveTasks();
    renderTasks();
  }

  function editTask(index) {
    const task = tasks[index];
    document.getElementById('task-input').value = task.text;
    isEditing = true;
    editIndex = index;
  }

  function deleteTask(index) {
    if (confirm("Are you sure you want to delete this task?")) {
      tasks.splice(index, 1);
      saveTasks();
      renderTasks();
    }
  }

  function completeTask(index) {
    tasks[index].completed = true;
    saveTasks();
    renderTasks();
  }

  // Clock
  function updateClock() {
    const now = new Date();
    document.getElementById("clock").textContent = now.toLocaleTimeString();
  }
  setInterval(updateClock, 1000);
  updateClock();

  function toggleUserList() {
    const submenu = document.getElementById('userSubMenu');
    submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
  }

  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("userSearch");
    const resultList = document.getElementById("filteredUsers");
    if (searchInput) {
      searchInput.addEventListener("input", function () {
        const searchTerm = searchInput.value.toLowerCase();
        resultList.innerHTML = "";
        const filtered = users.filter(u => u.toLowerCase().includes(searchTerm));
        if (filtered.length === 0) {
          resultList.innerHTML = "<li class='text-muted'>No users found</li>";
        } else {
          filtered.forEach(u => {
            const li = document.createElement("li");
            li.textContent = u;
            li.style.cursor = "pointer";
            li.onclick = () => {
              searchInput.value = u;
              resultList.innerHTML = "";
              alert("Selected: " + u);
            };
            resultList.appendChild(li);
          });
        }
      });
    }
  });

  renderTasks();
</script>
</body>
</html>